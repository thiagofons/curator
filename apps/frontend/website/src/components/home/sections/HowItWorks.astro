---
import Step1 from "@/assets/images/home/step-1.png";
import Step2 from "@/assets/images/home/step-2.png";
import Step3 from "@/assets/images/home/step-3.png";
import { APP_ROUTES } from "@/constants/routes";
import { getLangFromUrl, useTranslations } from "@/i18n/utils";
import {
  BodyBase,
  H2,
  H3,
  SubheadingLG,
  SubheadingXS,
} from "@repo/ui-web/components/custom/typography.jsx";
import { Image } from "astro:assets";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const steps = [
  {
    badge: t("home.how_it_works.step1.badge"),
    title: t("home.how_it_works.step1.title"),
    description: t("home.how_it_works.step1.description"),
    image: Step1,
    reversed: false,
    loading: "eager" as const,
    fetchpriority: "high" as const,
  },
  {
    badge: t("home.how_it_works.step2.badge"),
    title: t("home.how_it_works.step2.title"),
    description: t("home.how_it_works.step2.description"),
    image: Step2,
    reversed: true,
    loading: "eager" as const,
    fetchpriority: "auto" as const,
  },
  {
    badge: t("home.how_it_works.step3.badge"),
    title: t("home.how_it_works.step3.title"),
    description: t("home.how_it_works.step3.description"),
    image: Step3,
    reversed: false,
    loading: "lazy" as const,
    fetchpriority: "low" as const,
  },
];
---

<section
  id={APP_ROUTES.HOME.sections.HOW_IT_WORKS}
  class="relative z-10 bg-background py-24"
>
  <div class="mx-auto max-w-225 px-6">
    <!-- Header -->
    <div class="mb-16 flex flex-col items-center gap-4 text-center">
      <H2 color="foreground">{t("home.how_it_works.title")}</H2>
      <SubheadingLG color="muted-foreground" className="max-w-md">
        {t("home.how_it_works.subtitle")}
      </SubheadingLG>
    </div>

    <!-- Steps -->
    <div class="flex flex-col gap-20 md:gap-28">
      {
        steps.map((step) => (
          <div
            class={`flex flex-col items-center gap-10 md:flex-row md:items-center md:gap-16 ${step.reversed ? "md:flex-row-reverse" : ""}`}
          >
            <!-- Image -->
            <div class="w-full max-w-xs shrink-0 md:w-2/5 md:max-w-none lg:w-1/2 xl:w-[55%]">
              <Image
                src={step.image}
                alt={step.title}
                loading={step.loading}
                fetchpriority={step.fetchpriority}
                widths={[320, 480, 640, 800, 1024]}
                sizes="(max-width: 768px) 80vw, (max-width: 1024px) 40vw, (max-width: 1280px) 50vw, 55vw"
                class="mx-auto h-auto w-full drop-shadow-xl"
              />
            </div>

            <!-- Content -->
            <div class="flex flex-col gap-4 text-center md:text-left">
              <span class="inline-flex w-fit self-center rounded-full bg-primary px-4 py-1.5 md:self-start">
                <SubheadingXS color="primary-foreground">{step.badge}</SubheadingXS>
              </span>
              <H3 color="foreground">{step.title}</H3>
              <BodyBase color="muted-foreground">{step.description}</BodyBase>
            </div>
          </div>
        ))
      }
    </div>
  </div>
</section>
