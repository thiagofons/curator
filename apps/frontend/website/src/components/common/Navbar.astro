---
import menu from "@/config/menu.json";
import { getLangFromUrl, useTranslations } from "@/i18n/utils";
import Logo from "./Logo.astro";
import NavbarBase from "./Navbar";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const { isFeatureEnabled } = Astro.locals;

const getMenuLink = (path: string) => {
  if (path.startsWith("http")) return path;
  if (lang === "pt") return path;

  const cleanPath = path.startsWith("/") ? path : `/${path}`;
  if (cleanPath === "/" && lang) return `/${lang}`;
  return `/${lang}${cleanPath}`;
};

const navItems = menu.main
  .filter((item) => {
    return isFeatureEnabled(item.name);
  })
  .map((item) => {
    return {
      label: t(`nav.${item.name}` as any),
      url: getMenuLink(item.url),
    };
  });

const isCTAEnabled = isFeatureEnabled("start_journey");

const cta = {
  enabled: isCTAEnabled,
  label: t("nav.start_journey"),
};
---

<NavbarBase client:load items={navItems} cta={cta}>
  <Logo slot="logo" size="md" />
</NavbarBase>
